<!DOCTYPE html>
<html>
<head>
    <title>js-源生之canvas图片旋转、水平翻转、垂直翻转教程</title>
</head>

<body>
    <div id="div1">
        <!--data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAFA3PEY8MlBGQUZaVVBfeMiCeG5uePWvuZHI////////////////////////////////////////////////////2wBDAVVaWnhpeOuCguv/////////////////////////////////////////////////////////////////////////wAARCAEsAMgDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwC1RRRUjCiiigAoopPWgA70tJ3o70AKaBSHmjNAxaKTNGTigBaTNHQUe9AC0U3JpcmiwC0UCigQUUUUAFFFFABRRRQAUUUUAFFFBIAySAPegAooBBGQc0UAFJilpKADFGKKKADmlxSUZoAXAowKSjtQAYoxRRQAuBRgUnNFAC0UDpRQAUUEgDJOB71C1yg+6C30oAmoqOKUSZBBVh1BqSgAooooAKKKKACq8g82bB5VePx71YJwM+lQwDPJ69fzpoBjQmI7oydvoOo/xpyzEDLDcP7y/wCFSMXU5ADD0HBFRMAcvHz/AHl7/wCf50ATqwYZUgilqsOu5Dgn8jUqTAna42t+hpWAkoNFFABRRijFABRmjFGK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-->
        <img id="img1" style="display: none;" src="./img/_temporary/5.jpg" />
        <canvas id="canvas" width="500" height="500"></canvas>
        <div>
            <input id="rotate" type="button" value="rotate"></input>
            <input id="horizontal" type="button" value="Flip horizontal"></input>
            <input id="vertical" type="button" value="Flip vertical"></input>
            <input id="zoom1" type="button" value="zoom -"></input>
            &nbsp;<span id="percentage" style="font-size: 12px;">100%</span>&nbsp;
            <input id="zoom2" type="button" value="zoom +"></input>
            <input id="reset" type="button" value="reset"></input>
        </div>
    </div>
</body>
<script>
    (function () {
        var percentage = document.getElementById('percentage');
        var zoomBtn1 = document.getElementById('zoom1');
        var zoomBtn2 = document.getElementById('zoom2');
        var canvas = document.getElementById('canvas');
        var context = canvas.getContext("2d");
        var img = new Image();
        var _timer = null;
        var _width = canvas.width;
        var _height = canvas.height;
        var _imgW = 0;
        var _imgH = 0;
        var _x = 1;
        var _y = 1;
        var _radian = 0;
        var precision = 0.25;

        img.crossOrigin = "anonymous";
        img.src = document.getElementById('img1').src;
        img.onload = function () {
            _imgW = img.width;
            _imgH = img.height;
            context.drawImage(img, 0, 0);
            drawing(0);
        };

        document.getElementById('rotate').onclick = function () {
            if (parseInt(this.title)) {
                return;
            }

            this.title = 1;

            rotating(this);
        };

        document.getElementById('horizontal').onclick = function () {
            _radian = Math.PI - _radian;
            _x *= -1;
            drawing(_radian);
        };

        document.getElementById('vertical').onclick = function () {
            _radian = Math.PI - _radian;
            _y *= -1;
            drawing(_radian);
        };

        zoomBtn1.onclick = function () {
            var old_y = checkShaft(_y);
            if (old_y <= 0.01 || parseInt(this.title) || parseInt(zoomBtn2.title)) {
                // 缩小最多到原图的0.01倍
                return;
            }

            this.title = 1;

            switch (old_y) {
                case 0.25: // 等于0.25
                    precision = -0.13;
                    break;
                case 0.12: // 等于0.12
                    precision = -0.06;
                    break;
                case 0.06: // 等于0.06
                    precision = -0.03;
                    break;
                case 0.03: // 等于0.03
                    precision = -0.02;
                    break;
                default: // 其他情况 0.25
                    precision = -0.25;
            }

            var xy = scaling(_y, _x, precision);
            new_y = checkShaft(xy.y); // 计算缩放后的Y轴

            percentage.innerHTML = (new_y * 100) + '%';

            setZoom(this, old_y, new_y, precision);
        };

        zoomBtn2.onclick = function () {
            var old_y = checkShaft(_y);
            if (old_y >= 3 || parseInt(this.title) || parseInt(zoomBtn1.title)) {
                // 最多原图3倍放大
                return;
            }

            this.title = 1;

            switch (old_y) {
                case 0.01: // 等于0.02
                    precision = 0.02;
                    break;
                case 0.03: // 等于0.03
                    precision = 0.03;
                    break;
                case 0.06: // 等于0.06
                    precision = 0.06;
                    break;
                case 0.12: // 等于0.12
                    precision = 0.13;
                    break;
                default: // 其他情况 0.25
                    precision = 0.25;
            }

            var xy = scaling(_y, _x, precision);
            new_y = checkShaft(xy.y); // 计算缩放后的Y轴

            percentage.innerHTML = (new_y * 100) + '%';

            setZoom(this, old_y, new_y, precision);
        };

        document.getElementById('reset').onclick = function () {
            _x = 1;
            _y = 1;
            _radian = 0;
            precision = 0.25;
            percentage.innerHTML = '100%';
            zoomBtn1.title = 0;
            zoomBtn2.title = 0;
            drawing(_radian);
        };

        // 重新绘图
        function drawing(radian) {
            context.save();
            context.clearRect(0, 0, _width, _height);
            context.translate(_width / 2, _height / 2);
            context.rotate(radian);
            context.scale(_y, _x);
            context.drawImage(img, -_imgW / 2, -_imgH / 2);
            context.restore();
        }

        // 旋转过度动画
        function rotating(btn) {
            var _i = 0;
            (function animation() {
                if (_i >= 10) {
                    _i = 0;
                    cancelAnimationFrame(_timer);
                    _timer = null;
                    btn.title = 0;
                } else {
                    _radian += Math.PI / 20;
                    drawing(_radian);
                    _i++;
                    _timer = requestAnimationFrame(function () {
                        animation();
                    });
                }
            })();
        }

        // 检查轴并将负数转为正整数
        function checkShaft(scale) {
            return scale < 0 ? -(scale) : scale;
        }

        // 缩放大小 返回缩放后（y，x）轴的值
        function scaling(y, x, zoom) {
            function getZoom(scale, zoom) {
                return scale > 0 && scale > -zoom ? zoom :
                    scale < 0 && scale < zoom ? -zoom : 0;
            }

            y += getZoom(y, zoom);
            x += getZoom(x, zoom);
            
            return {
                y: y.toFixed(3) * 1,
                x: x.toFixed(3) * 1
            }
        }

        function setZoom(Btn, oldY, newY, precision) {
            var _oldY = oldY;
            var _xy = {};
            var _precision = precision / 10;
            (function animation() {
                if (_oldY == newY) {
                    cancelAnimationFrame(_timer);
                    _timer = null;
                    Btn.title = 0;
                } else {
                    _xy = scaling(_y, _x, _precision); // 计算缩放后的YX轴
                    _y = _xy.y; 
                    _x = _xy.x;
                    drawing(_radian);
                    _oldY = (_oldY + _precision).toFixed(3) * 1;
                    _timer = requestAnimationFrame(function () {
                        animation();
                    });
                }
            })();
        }
    })();
</script>
</html>